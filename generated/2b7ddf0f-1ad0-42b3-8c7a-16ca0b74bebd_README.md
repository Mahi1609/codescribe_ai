# üëã Welcome to 2b7ddf0f-1ad0-42b3-8c7a-16ca0b74bebd

üìÑ *This documentation was automatically generated by [CodeScribe AI](https://github.com/Mahi1609/codescribe_ai.git)*

---

## üß† Overview
### Code File Summaries

The project is a Python-based invoice extraction tool utilizing Optical Character Recognition (OCR) and a local Ollama Large Language Model (LLM). The primary function is performed in the `main.py` file, which orchestrates the extraction of text from PDF files, cleans the extracted text, and then uses the Ollama model to generate structured invoice fields. Key dependencies include custom modules such as `ocr_handler` for text extraction, `ollama_parser` for invoice field generation, and `text_cleaner` for preprocessing the extracted text. The tool saves the structured output to a JSON file in an "output" directory. 

* **Purpose**: Extract invoice fields from PDF files using OCR and a local LLM.
* **Key Functions/Classes**: 
  + `extract_text_from_pdf` (OCR extraction)
  + `generate_invoice_fields` (LLM-based invoice field generation)
  + `clean_ocr_text` (text preprocessing)
* **Inputs/Outputs**: 
  + Input: Path to a PDF file
  + Output: Structured invoice fields saved to a JSON file
* **Side-Effects**: 
  + Creates an "output" directory if it does not exist
  + Saves a JSON file containing the structured invoice fields and raw model response
* **Important Dependencies**: Custom modules (`ocr_handler`, `ollama_parser`, `text_cleaner`) and standard Python libraries (`os`, `sys`, `json`).

---

## üîç What Does This Project Do?
This project is designed to ### Code File Summaries

#### PROJECT_PURPOSE
This project is designed to extract invoice fields from PDF files using Optical Character Recognition (OCR) and a local Ollama Large Language Model (LLM).

#### main.py
**Purpose:** Extract invoice fields from a PDF file and save the structured output to a JSON file.
**Key Functions:**
* `main(pdf_path)`: The main entry point of the script, responsible for orchestrating the invoice extraction process.
* `extract_text_from_pdf(pdf_path)`: Extracts text from a PDF file using OCR (defined in `ocr/ocr_handler.py`).
* `generate_invoice_fields(cleaned_text)`: Sends the preprocessed text to the local Ollama model to extract invoice fields (defined in `llm/ollama_parser.py`).
* `clean_ocr_text(text)`: Preprocesses the extracted text before sending it to the Ollama model (defined in `utils/text_cleaner.py`).
**Inputs:**
* `pdf_path`: The path to the PDF file to extract invoice fields from.
**Outputs:**
* A JSON file containing the structured invoice fields and the raw output from the Ollama model.
**Side-Effects:**
* Creates an `output` directory if it does not exist.
* Saves the structured output to a JSON file in the `output` directory.
**Dependencies:**
* `os` and `sys` for file system interactions and command-line argument parsing.
* `json` for encoding the output to a JSON file.
**Framework Patterns:**
* The script uses a modular design, with separate modules for OCR handling, Ollama model interaction, and text cleaning.
* The `main` function orchestrates the entire process, making it easy to follow the flow of the script. 

Some important points to note:
* The script expects a PDF file path as a command-line argument.
* The script assumes that the Ollama model is available locally and can be interacted with through the `llm/ollama_parser.py` module.
* The script saves the structured output to a JSON file in the `output` directory, with the same name as the input PDF file but with a `_extracted.json` extension.

---

## üõ† Tech Stack Used
- **Detected Environment:** `python`
- **Languages & Frameworks:**


  - Python

  - Node

  - System



---

## üì¶ Dependencies


### Python


- PIL

- fitz

- llm

- ocr

- pytesseract

- requests



### Node

- No dependencies detected


### System


- Install Ollama from https://ollama.ai (required for running local LLMs).

- Install Tesseract OCR (e.g., `sudo apt-get install tesseract-ocr`).







---

## ‚öôÔ∏è Installation & Run
To get started with this project:

### Clone the repository
```bash
git clone <your-repo-url>
cd 2b7ddf0f-1ad0-42b3-8c7a-16ca0b74bebd
```

### (Optional) Create a virtual environment
```bash
python -m venv venv
source venv/bin/activate   # On Windows: venv\Scripts\activate
```

### Install dependencies

```bash
pip install -r requirements.txt
```


### How to run
```bash
## Clone the repository
git clone <your-repo-url>
cd 2b7ddf0f-1ad0-42b3-8c7a-16ca0b74bebd

## Install dependencies
pip install -r requirements.txt

## Run the app
python main.py
```

---

## üß© Code File Summaries

### üìÑ `debug_ocr.py`
### debug_ocr.py

**Purpose:** 
The `debug_ocr.py` script is designed to extract and display text from a PDF file using Optical Character Recognition (OCR) for debugging purposes.

**Key Components:**
* Extracts text from a PDF file page by page using the `extract_text_from_pdf` function from `ocr.ocr_handler`.
* Prints the extracted text to the console, truncating each page's text to 1000 characters with an ellipsis if more text is available.

**Usage and Dependencies:**
* Run the script from the command line, providing the path to a PDF file as an argument: `python debug_ocr.py <pdf_path>`.
* Depends on the `ocr.ocr_handler` module and system dependencies Tesseract OCR and Ollama.

**Behavior:**
* Prints usage instructions if run without a PDF file path argument.
* Prints extracted text to the console for debugging purposes.


### üìÑ `main.py`
### main.py Summary

**Purpose:** 
The `main.py` script extracts invoice fields from a given PDF file using Optical Character Recognition (OCR) and a local Ollama Large Language Model (LLM).

**Key Components:**
* Orchestrates extraction process using `main` function
* Utilizes `extract_text_from_pdf` for OCR, `generate_invoice_fields` for LLM-based field extraction, and `clean_ocr_text` for text preprocessing

**Inputs and Outputs:**
* **Input:** PDF file path (command-line argument)
* **Outputs:**
  + Console: Structured invoice fields
  + File: JSON file containing raw model output and structured fields (saved to `output` directory)

**Side-Effects:**
* Creates `output` directory if it does not exist
* Saves JSON file containing extraction results

**Dependencies:**
* Python libraries: `PIL`, `fitz`, `llm`, `ocr`, `pytesseract`, `requests`
* System dependencies: Ollama LLM, Tesseract OCR

**Usage:**
Run the script using `python main.py <path_to_pdf>`, replacing `<path_to_pdf>` with the path to your PDF file.


### üìÑ `llm/ollama_parser.py`
### Code File Summaries: `llm/ollama_parser.py`

The `ollama_parser.py` file parses invoice text using a local Large Language Model (LLM) API, extracting structured information.

* **Purpose**: Extract relevant fields from invoice text via a local LLM API.
* **Key Functions**:
  + `generate_invoice_fields(text)`: Takes invoice text, sends a prompt to the local LLM API, and returns parsed data in JSON format.
* **Inputs/Outputs**:
  + Input: `text` (invoice text to be parsed)
  + Outputs:
    - `json_data`: Dictionary containing extracted invoice fields (e.g., `invoice_id`, `invoice_number`, `invoice_date`)
    - `raw_output`: Raw LLM API response (JSON or error message)
* **Side-Effects**:
  + Sends a POST request to the local LLM API at `http://localhost:11434/api/generate`
  + Returns a default dictionary with empty values if the API request fails
* **Important Dependencies**:
  + `requests` library for HTTP requests
  + Local LLM API (Mistral model) at `http://localhost:11434`
  + Ollama installation from `https://ollama.ai` and Tesseract OCR installation (e.g., `sudo apt-get install tesseract-ocr`)

The `generate_invoice_fields` function constructs a prompt with the invoice text, sends it to the LLM API, and returns the extracted data as a dictionary. If the API request fails, it returns a default dictionary with empty values.


### üìÑ `ocr/ocr_handler.py`
### ocr_handler.py
#### Purpose
The `ocr_handler.py` file facilitates text extraction from scanned PDFs using Optical Character Recognition (OCR).

#### Key Components
* **Functionality**: Extracts text from each page of a scanned PDF.
* **Input**: PDF file path (`pdf_path`) as a string.
* **Output**: A dictionary with page numbers (prefixed with "page_") as keys and extracted text as values.

#### Behavior and Dependencies
This code utilizes `fitz` for PDF processing, `pytesseract` for OCR, and `PIL` for image processing. It opens a PDF, converts each page to an image, applies OCR, and stores the extracted text in a dictionary. The function returns this dictionary, raising a `FileNotFoundError` if the PDF file does not exist.

#### Notes
* High-quality OCR accuracy is achieved with a DPI setting of 300.
* The `pytesseract` library's `image_to_string` function performs the OCR operation, and extracted text is stripped of leading and trailing whitespace.


### üìÑ `utils/text_cleaner.py`
### Code File Summaries: `utils/text_cleaner.py`

The `text_cleaner.py` module is designed to clean and normalize text extracted from Optical Character Recognition (OCR) processes. 

* **Purpose**: Improve readability and usability of OCR text for further processing.
* **Key Functions**:
  * `clean_ocr_text(text)`: Cleans and normalizes input OCR text.
* **Inputs/Outputs**:
  * **Input**: Raw OCR text (string)
  * **Output**: Cleaned and normalized OCR text (string)
* **Side-Effects**: None
* **Important Dependencies**: Python's built-in `re` module for text processing.
* **Behavior and Intent**: Addresses common OCR issues, including:
  * Removing extra whitespaces and line breaks
  * Fixing broken words with hyphenations
  * Normalizing punctuation and special characters
  * Correcting common OCR misreads
This function is intended to be expanded with additional corrections as needed, based on specific requirements and common errors encountered in the OCR text.

